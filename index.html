<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Maker</title>
    <!-- Link to the external stylesheet -->
    <link rel="stylesheet" href="style.css">
    <!-- Link to the external JavaScript files. 'defer' is important! -->
    <!-- Core Setup: Defines global variables and state -->
    <script src="setup.js" defer></script>

    <!-- Foundational Scripts: Define data, classes, and core functions -->
    <script src="drawing.js" defer></script>
    <script src="templates.js" defer></script>
    <script src="style-presets.js" defer></script>
    <script src="font-loader.js" defer></script>
    <script src="people-images.js" defer></script>
    <script src="styled-text-snippets.js" defer></script>
    <script src="shape-picker.js" defer></script>

    <!-- Dependent Scripts: Use foundational functions and data -->
    <script src="preset-layouts.js" defer></script>
    <script src="controls.js" defer></script>
    <script src="canvas-objects.js" defer></script>
    <script src="line-toggles-styles.js" defer></script>
    <script src="canvas-interactions.js" defer></script>
    <script src="ai-image.js" defer></script>
    <script src="emoji-picker.js" defer></script>
    <script src="font-preview.js" defer></script>

    <!-- Main Orchestrator: Initializes the app and attaches event listeners -->
    <script src="main.js" defer></script>
    <script type="module" defer>
        import { polyfillCountryFlagEmojis } from "https://cdn.skypack.dev/country-flag-emoji-polyfill";
        polyfillCountryFlagEmojis();
        console.log("Twemoji Country Flags font polyfill loaded.");
    </script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
</head>
<body>
    <!-- The entire body of your index3.html file goes here, unchanged. -->
    <!-- For brevity, I'm not pasting the 500+ lines of body HTML, -->
    <!-- but you should copy it directly from your index3.html file. -->
    <div class="app-grid">
        <header class="app-header">
            <h1>Thumbnail Maker</h1>
            <button id="theme-toggle-btn" class="theme-toggle">Toggle Dark Mode</button>
        </header>

        <aside class="left-panel">
            <!-- All the layout presets and text line controls go here -->
            <div class="panel-section">
                <h2>Layouts</h2>
                <div class="layout-presets">
                    <!-- Existing 6 layouts -->
                    <button class="layout-btn" data-layout-id="1">
                        <div class="layout-icon">
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Part 1 (Old)
                    </button>
                    <button class="layout-btn" data-layout-id="2">
                        <div class="layout-icon">
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Part 2 (Old)
                    </button>
                    <button class="layout-btn" data-layout-id="3">
                        <div class="layout-icon">
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Part 3 (Old)
                    </button>
                    <button class="layout-btn" data-layout-id="4">
                        <div class="layout-icon">
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 45%"></div>
                                <div class="layout-line" style="width: 45%"></div>
                            </div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Extra (Old)
                    </button>
                    <button class="layout-btn" data-layout-id="5">
                        <div class="layout-icon">
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 65%"></div>
                                <div class="layout-line" style="width: 30%"></div>
                            </div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Mapping Update
                    </button>
                    <button class="layout-btn" data-layout-id="6">
                        <div class="layout-icon">
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 95%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Breaking (Old)
                    </button>

                    <!-- NEW ROW OF 5 LAYOUTS (Generic) -->
                    <button class="layout-btn" data-layout-id="7">
                        <div class="layout-icon"> <!-- Generic Icon -->
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 45%"></div>
                                <div class="layout-line" style="width: 45%"></div>
                            </div>
                            <div class="layout-line" style="width: 90%; margin-bottom: 15px; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: auto"></div>
                        </div>
                        Breaking Gap (Old)
                    </button>
                    <button class="layout-btn" data-layout-id="8">
                        <div class="layout-icon"> <!-- Generic Icon -->
                            <div class="layout-line" style="width: 40%; margin-left: 0; margin-right: auto"></div>
                            <div class="layout-line" style="width: 50%; margin-left: 0; margin-right: auto"></div>
                            <div class="layout-line" style="width: 40%; margin-left: 0; margin-right: auto"></div>
                            <div class="layout-line" style="width: 70%; margin-left: auto; margin-right: 0"></div>
                        </div>
                        3 L + 1 R
                    </button>
                    <button class="layout-btn" data-layout-id="9">
                        <div class="layout-icon"> <!-- Generic Icon -->
                            <div class="layout-line" style="width: 40%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 50%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 40%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 70%; margin-left: 0; margin-right: auto"></div>
                        </div>
                        3 R + 1 L
                    </button>
                    <button class="layout-btn" data-layout-id="10">
                        <div class="layout-icon"> <!-- Generic Icon -->
                            <div class="layout-line" style="width: 30%; margin-bottom: 10px; margin-left: auto; margin-right: 0"></div>
                        </div>
                        BOOM!
                    </button>
                    <button class="layout-btn" data-layout-id="11">
                        <div class="layout-icon" style="background-color: #db8f0a">
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 50%"></div>
                                <div class="layout-line" style="width: 50%"></div>
                            </div>
                            <div class="layout-line" style="width: 30%; margin-bottom: 10px; margin-left: 5; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>

                        </div>
                        Hits & Losses
                    </button>
                    <!-- END NEW ROW OF 5 LAYOUTS -->

                    <!-- NEW ROW OF 4 LAYOUTS (to make it 15 total) -->
                     <button class="layout-btn" data-layout-id="12">
                        <div class="layout-icon" style="background-color: #0edb0a"> <!-- Generic Icon -->
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 50%"></div>
                                <div class="layout-line" style="width: 50%"></div>
                            </div>
                            <div class="layout-line" style="width: 30%; margin-bottom: 10px; margin-left: 5; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>


                        </div>
                        Military Aid
                    </button>
                    <button class="layout-btn" data-layout-id="13">
                        <div class="layout-icon" style="background-color: #db0ad8"> <!-- Generic Icon -->
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 50%"></div>
                                <div class="layout-line" style="width: 50%"></div>
                            </div>
                            <div class="layout-line" style="width: 30%; margin-bottom: 10px; margin-left: 5; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>

                        </div>
                        Geopol News
                    </button>
                    <button class="layout-btn" data-layout-id="14">
                        <div class="layout-icon" style="background-color: #ffff00"> <!-- Generic Icon -->
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 50%"></div>
                                <div class="layout-line" style="width: 50%"></div>
                            </div>
                            <div class="layout-line" style="width: 30%; margin-bottom: 10px; margin-left: 5; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>

                        </div>
                        Extra / Specials
                    </button>
                    <button class="layout-btn" data-layout-id="15">
                        <div class="layout-icon" style="background-color: #000000"> <!-- Generic Icon -->
                            <div style="display: flex; justify-content: center">
                                <div class="layout-line" style="width: 50%"></div>
                                <div class="layout-line" style="width: 50%"></div>
                            </div>
                            <div class="layout-line" style="width: 30%; margin-bottom: 10px; margin-left: 5; margin-right: auto"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>
                            <div class="layout-line" style="width: 80%; margin-left: auto; margin-right: 0"></div>

                        </div>
                        Breaking news
                    </button>
                    <button class="layout-btn" data-layout-id="16" style="height: 100%">
                        <div class="layout-icon" style="background-color: #db8f0a; height: 5px">
    

                        </div>
                        ALT
                    </button>
                                    <!-- NEW ROW OF 4 LAYOUTS (to make it 15 total) -->
                     <button class="layout-btn" data-layout-id="17">
                        <div class="layout-icon" style="background-color: #0edb0a; height: 5px"> <!-- Generic Icon -->



                        </div>
                       Alt
                    </button>
                    <button class="layout-btn" data-layout-id="18">
                        <div class="layout-icon" style="background-color: #db0ad8; height: 5px"> <!-- Generic Icon -->


                        </div>
                        Alt
                    </button>
                    <button class="layout-btn" data-layout-id="19">
                        <div class="layout-icon" style="background-color: #ffff00; height: 5px"> <!-- Generic Icon -->


                        </div>
                        Alt
                    </button>
                    <button class="layout-btn" data-layout-id="20">
                        <div class="layout-icon" style="background-color: #000000; height: 5px"> <!-- Generic Icon -->


                        </div>
                        Alt
                    </button>
                        <button class="layout-btn" data-layout-id="21" style="height: 100%">
                        <div class="layout-icon" style="background-color: #db8f0a; height: 5px">
    

                        </div>
                        Rule-6s (R)
                    </button>
                                    <!-- NEW ROW OF 4 LAYOUTS (to make it 15 total) -->
                     <button class="layout-btn" data-layout-id="22">
                        <div class="layout-icon" style="background-color: #0edb0a; height: 5px"> <!-- Generic Icon -->



                        </div>
                        Rule-6s (R)
                    </button>
                    <button class="layout-btn" data-layout-id="23">
                        <div class="layout-icon" style="background-color: #db0ad8; height: 5px"> <!-- Generic Icon -->


                        </div>
                        Rule-6s (R)
                    </button>
                    <button class="layout-btn" data-layout-id="24">
                        <div class="layout-icon" style="background-color: #ffff00; height: 5px"> <!-- Generic Icon -->


                        </div>
                        Rule-6s (R)
                    </button>
                    <button class="layout-btn" data-layout-id="25">
                        <div class="layout-icon" style="background-color: #000000; height: 5px"> <!-- Generic Icon -->


                        </div>
                        Rule-6s (R)
                    </button>
                <!-- END NEW ROW OF 4 LAYOUTS -->
                </div>
                <!-- PASTE THIS CODE IN index.html -->
            </div>
            <div class="panel-section">
                <button id="show-font-preview-modal-btn" style="width: 100%; margin-bottom: 15px;">Preview All Fonts</button>
            </div>

            <div class="panel-section">
                <h2>Add Elements</h2>
                <div class="add-object-grid">
                    <button id="add-shape-btn" class="add-object-btn">Add Shape</button>
                    <button id="add-styled-text-btn" class="add-object-btn">Add Styled Text</button>
                    <button id="add-person-btn" class="add-object-btn">Add Person</button>
                </div>
            </div>
            <div class="panel-section">
                <h2>Text Lines</h2>    
                <div class="text-input-group">
                    <div class="text-input">
                        <input type="text" id="text1" value="UKRAINE WAR" placeholder="Text Line 1">
                        <div class="color-input-container">
                            <input type="color" id="color1" value="#4B4BE2">
                            <div class="color-preview" id="preview1"></div>
                        </div>
                        <input type="number" id="size1" value="160" min="10" max="500">
                    </div>
                    <div class="toggle-controls-container">
                        <button class="toggle-btn" data-controls="pos1">Position</button>
                        <button class="toggle-btn" data-controls="style1">Style</button>
                        <button class="toggle-btn" data-controls="bg1">Background</button>
                        <button class="toggle-btn" data-controls="shadow1">Shadow</button>
                        <button class="toggle-btn" data-controls="fx1">FX</button>
                        <button class="toggle-btn" data-controls="presets1">Presets</button>


                    </div>
                    <div id="pos1" class="collapsible-controls">
                        <div class="text-position-controls">
                            <label>X: <input type="number" id="x1" class="pos-input" value="960"></label>
                            <label>Y: <input type="number" id="y1" class="pos-input" value="756"></label>
                            <button class="align-btn" data-align="left" data-line-index="0">L</button>
                            <button class="align-btn" data-align="center" data-line-index="0">C</button>
                            <button class="align-btn" data-align="right" data-line-index="0">R</button>
                        </div>
                    </div>
                    <div id="style1" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Stroke: <input type="color" id="strokeColor1" value="#000000"></label>
                            <label>Thick: <input type="number" id="strokeThickness1" class="pos-input" value="2" min="0" max="50"></label>
                        </div>
                    </div>
                    <div id="bg1" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label>BG: <input type="color" id="bgColor1" value="#ffffff"></label>
                            <label>BG Pad: <input type="number" id="bgPadding1" class="pos-input" value="10" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label><input type="checkbox" id="bgFullWidth1"> Full BG</label>
                            <label>BG Alpha: <input type="range" id="bgAlpha1" min="0" max="100" value="0" step="5"> <span id="bgAlphaValue1">0%</span></label>
                        </div>
                    </div>
                    <div id="shadow1" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label title="Enable Shadow"><input type="checkbox" id="shadowEnabled1"> Enable Shadow</label>
                            <label>Shadow Color: <input type="color" id="shadowColor1" value="#000000"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Shadow Alpha: <input type="range" id="shadowAlpha1" min="0" max="100" value="50" step="5"> <span id="shadowAlphaValue1">50%</span></label>
                            <label>Shadow Blur: <input type="number" id="shadowBlur1" class="pos-input" value="5" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Offset X: <input type="number" id="shadowOffsetX1" class="pos-input" value="2" min="-50" max="50"></label>
                            <label>Offset Y: <input type="number" id="shadowOffsetY1" class="pos-input" value="2" min="-50" max="50"></label>
                        </div>
                    </div>    
                    <div id="fx1" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Font:
                                <select id="fontFamily1">
                                    <!-- Options will be populated by script.js -->
                                </select>
                            </label>
                            <label>Effect:
                                <select id="advancedEffectType1">
                                    <option value="none">None</option>
                                    <option value="neon">Neon</option>
                                    <option value="splice">Splice</option>
                                    <option value="echo">Echo</option>
                                    <option value="glitch">Glitch</option>
                                </select>
                            </label>
                        </div>
                        <!-- Contextual controls for effects, hidden by default -->
                        <div id="fx-params1" class="text-style-controls fx-params">
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C1: <input type="color" id="effectColor1_1"></label>
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C2: <input type="color" id="effectColor2_1"></label>
                            <label class="fx-param-control" data-fx-for="glitch">FX C3: <input type="color" id="effectColor3_1"></label>
                            <label class="fx-param-control" data-fx-for="splice echo glitch">Dist: <input type="range" id="effectDistance1" min="0" max="50" value="10"></label>
                            <label class="fx-param-control" data-fx-for="splice echo">Angle: <input type="range" id="effectAngle1" min="-180" max="180" value="-45"></label>
                            <label class="fx-param-control" data-fx-for="neon">Glow: <input type="range" id="effectGlowSize1" min="0" max="100" value="20"></label>
                        </div>
                    </div>
                    <div id="presets1" class="collapsible-controls preset-gallery">
                            <!-- Preset previews will be generated here by JS -->
                    </div>  
                </div>
                <div class="presets" id="titlePresets">
                    <button class="preset-btn" data-preset-group="title" data-preset-value="UKRAINE WAR">Ukraine War</button>
                    <button class="preset-btn" data-preset-group="title" data-preset-value="US POLITICS">US Politics</button>
                    <button class="preset-btn" data-preset-group="title" data-preset-value="UPDATE">Update</button>
                </div>
                <div class="text-input-group">
                    <div class="text-input">
                        <input type="text" id="text2" value="NEWS UPDATE" placeholder="Text Line 2">
                        <div class="color-input-container">
                            <input type="color" id="color2" value="#ffff00">
                            <div class="color-preview" id="preview2"></div>
                        </div>
                        <input type="number" id="size2" value="160" min="10" max="500">
                    </div>
                    <div class="toggle-controls-container">
                        <button class="toggle-btn" data-controls="pos2">Position</button>
                        <button class="toggle-btn" data-controls="style2">Style</button>
                        <button class="toggle-btn" data-controls="bg2">Background</button>
                        <button class="toggle-btn" data-controls="shadow2">Shadow</button>
                        <button class="toggle-btn" data-controls="fx2">FX</button>
                        <button class="toggle-btn" data-controls="presets2">Presets</button>
                    </div>
                    <div id="pos2" class="collapsible-controls">
                        <div class="text-position-controls">
                            <label>X: <input type="number" id="x2" class="pos-input" value="960"></label>
                            <label>Y: <input type="number" id="y2" class="pos-input" value="756"></label>
                            <button class="align-btn" data-align="left" data-line-index="1">L</button>
                            <button class="align-btn" data-align="center" data-line-index="1">C</button>
                            <button class="align-btn" data-align="right" data-line-index="1">R</button>
                        </div>
                    </div>
                    <div id="style2" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Stroke: <input type="color" id="strokeColor2" value="#000000"></label>
                            <label>Thick: <input type="number" id="strokeThickness2" class="pos-input" value="2" min="0" max="50"></label>
                        </div>
                    </div>
                    <div id="bg2" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label>BG: <input type="color" id="bgColor2" value="#ffffff"></label>
                            <label>BG Pad: <input type="number" id="bgPadding2" class="pos-input" value="10" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label><input type="checkbox" id="bgFullWidth2"> Full BG</label>
                            <label>BG Alpha: <input type="range" id="bgAlpha2" min="0" max="100" value="0" step="5"> <span id="bgAlphaValue2">0%</span></label>
                        </div>
                    </div>
                    <div id="shadow2" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label title="Enable Shadow"><input type="checkbox" id="shadowEnabled2"> Enable Shadow</label>
                            <label>Shadow Color: <input type="color" id="shadowColor2" value="#000000"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Shadow Alpha: <input type="range" id="shadowAlpha2" min="0" max="100" value="50" step="5"> <span id="shadowAlphaValue2">50%</span></label>
                            <label>Shadow Blur: <input type="number" id="shadowBlur2" class="pos-input" value="5" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Offset X: <input type="number" id="shadowOffsetX2" class="pos-input" value="2" min="-50" max="50"></label>
                            <label>Offset Y: <input type="number" id="shadowOffsetY2" class="pos-input" value="2" min="-50" max="50"></label>
                        </div>
                    </div>
                    <div id="fx2" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Font:
                                <select id="fontFamily2">
                                    <!-- Options will be populated by script.js -->
                                </select>
                            </label>
                            <label>Effect:
                                <select id="advancedEffectType2">
                                    <option value="none">None</option>
                                    <option value="neon">Neon</option>
                                    <option value="splice">Splice</option>
                                    <option value="echo">Echo</option>
                                    <option value="glitch">Glitch</option>
                                </select>
                            </label>
                        </div>
                        <!-- Contextual controls for effects, hidden by default -->
                        <div id="fx-params2" class="text-style-controls fx-params">
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C1: <input type="color" id="effectColor1_2"></label>
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C2: <input type="color" id="effectColor2_2"></label>
                            <label class="fx-param-control" data-fx-for="glitch">FX C3: <input type="color" id="effectColor3_2"></label>
                            <label class="fx-param-control" data-fx-for="splice echo glitch">Dist: <input type="range" id="effectDistance2" min="0" max="50" value="10"></label>
                            <label class="fx-param-control" data-fx-for="splice echo">Angle: <input type="range" id="effectAngle2" min="-180" max="180" value="-45"></label>
                            <label class="fx-param-control" data-fx-for="neon">Glow: <input type="range" id="effectGlowSize2" min="0" max="100" value="20"></label>
                        </div>
                    </div>
                    <div id="presets2" class="collapsible-controls preset-gallery">
                        <!-- Preset previews will be generated here by JS -->
                    </div>    
                </div>
                <div class="presets" id="subtitlePresets">
                    <button class="preset-btn" data-preset-group="subtitle" data-preset-value="NEWS UPDATE">News Update</button>
                    <button class="preset-btn" data-preset-group="subtitle" data-preset-value="UPDATE EXTRA">Update Extra</button>
                    <button class="preset-btn" data-preset-group="subtitle" data-preset-value="SPECIAL">Special</button>
                    <button class="preset-btn" data-preset-group="subtitle" data-preset-value="BREAKING NEWS UPDATE">Breaking News Update</button>
                    <button class="preset-btn" data-preset-group="subtitle" data-preset-value="BUMPER NEWS UPDATE">Bumper News Update</button>
                    <button class="preset-btn" data-preset-group="subtitle" data-preset-value="UPDATE">Update</button>
                </div>
                <div class="text-input-group">
                    <div class="text-input">
                        <input type="text" id="text3" value="MAR-01 - Pt 1" placeholder="Text Line 3">
                        <div class="color-input-container">
                            <input type="color" id="color3" value="#ff0000">
                            <div class="color-preview" id="preview3"></div>
                        </div>
                        <input type="number" id="size3" value="160" min="10" max="500">
                    </div>
                    <div class="toggle-controls-container">
                        <button class="toggle-btn" data-controls="pos3">Position</button>
                        <button class="toggle-btn" data-controls="style3">Style</button>
                        <button class="toggle-btn" data-controls="bg3">Background</button>
                        <button class="toggle-btn" data-controls="shadow3">Shadow</button>
                        <button class="toggle-btn" data-controls="fx3">FX</button>
                        <button class="toggle-btn" data-controls="presets3">Presets</button>
                    </div>
                    <div id="pos3" class="collapsible-controls">
                        <div class="text-position-controls">
                            <label>X: <input type="number" id="x3" class="pos-input" value="960"></label>
                            <label>Y: <input type="number" id="y3" class="pos-input" value="756"></label>
                            <button class="align-btn" data-align="left" data-line-index="2">L</button>
                            <button class="align-btn" data-align="center" data-line-index="2">C</button>
                            <button class="align-btn" data-align="right" data-line-index="2">R</button>
                        </div>
                    </div>
                    <div id="style3" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Stroke: <input type="color" id="strokeColor3" value="#000000"></label>
                            <label>Thick: <input type="number" id="strokeThickness3" class="pos-input" value="2" min="0" max="50"></label>
                        </div>
                    </div>
                    <div id="bg3" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label>BG: <input type="color" id="bgColor3" value="#ffffff"></label>
                            <label>BG Pad: <input type="number" id="bgPadding3" class="pos-input" value="10" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label><input type="checkbox" id="bgFullWidth3"> Full BG</label>
                            <label>BG Alpha: <input type="range" id="bgAlpha3" min="0" max="100" value="0" step="5"> <span id="bgAlphaValue3">0%</span></label>
                        </div>
                    </div>
                    <div id="shadow3" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label title="Enable Shadow"><input type="checkbox" id="shadowEnabled3"> Enable Shadow</label>
                            <label>Shadow Color: <input type="color" id="shadowColor3" value="#000000"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Shadow Alpha: <input type="range" id="shadowAlpha3" min="0" max="100" value="50" step="5"> <span id="shadowAlphaValue3">50%</span></label>
                            <label>Shadow Blur: <input type="number" id="shadowBlur3" class="pos-input" value="5" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Offset X: <input type="number" id="shadowOffsetX3" class="pos-input" value="2" min="-50" max="50"></label>
                            <label>Offset Y: <input type="number" id="shadowOffsetY3" class="pos-input" value="2" min="-50" max="50"></label>
                        </div>
                    </div>
                    <div id="fx3" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Font:
                                <select id="fontFamily3">
                                    <!-- Options will be populated by script.js -->
                                </select>
                            </label>
                            <label>Effect:
                                <select id="advancedEffectType3">
                                    <option value="none">None</option>
                                    <option value="neon">Neon</option>
                                    <option value="splice">Splice</option>
                                    <option value="echo">Echo</option>
                                    <option value="glitch">Glitch</option>
                                </select>
                            </label>
                        </div>
                        <!-- Contextual controls for effects, hidden by default -->
                        <div id="fx-params3" class="text-style-controls fx-params">
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C1: <input type="color" id="effectColor1_3"></label>
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C2: <input type="color" id="effectColor2_3"></label>
                            <label class="fx-param-control" data-fx-for="glitch">FX C3: <input type="color" id="effectColor3_3"></label>
                            <label class="fx-param-control" data-fx-for="splice echo glitch">Dist: <input type="range" id="effectDistance3" min="0" max="50" value="10"></label>
                            <label class="fx-param-control" data-fx-for="splice echo">Angle: <input type="range" id="effectAngle3" min="-180" max="180" value="-45"></label>
                            <label class="fx-param-control" data-fx-for="neon">Glow: <input type="range" id="effectGlowSize3" min="0" max="100" value="20"></label>
                        </div>
                    </div>
                    <div id="presets3" class="collapsible-controls preset-gallery">
                        <!-- Preset previews will be generated here by JS -->
                    </div>                        
                </div>
                <div class="presets" id="datePresets">
                    <button class="preset-btn" data-preset-group="date" data-preset-value="{Date} - Pt 1">{Date} - Pt 1</button>
                    <button class="preset-btn" data-preset-group="date" data-preset-value="{Date} - Pt 2">{Date} - Pt 2</button>
                    <button class="preset-btn" data-preset-group="date" data-preset-value="{Date} - Pt 3">{Date} - Pt 3</button>
                    <button id="update-date-btn" class="preset-btn">Update Date</button>
                    <button class="preset-btn" data-preset-group="date" data-preset-value="LIVE CHAT & UPDATE">LIVE CHAT & UPDATE</button>
                    <button class="preset-btn" data-preset-group="date" data-preset-value="FULL FRONT LINE">Full Front Line</button>
                </div>            
                <div class="text-input-group">
                    <div class="text-input">
                        <textarea id="text4" placeholder="Text Line 4">HITS, STRIKES, LOSSES, OTHER</textarea>
                        <div class="text-input-rhs-controls"> <!-- New wrapper for color and size -->
                            <div class="color-input-container">
                                <input type="color" id="color4" value="#ff0000">
                                <div class="color-preview" id="preview4"></div>
                            </div>
                            <input type="number" id="size4" value="100" min="10" max="500">
                        </div>
                    </div>
                    <div class="toggle-controls-container">
                        <button class="toggle-btn" data-controls="pos4">Position</button>
                        <button class="toggle-btn" data-controls="style4">Style</button>
                        <button class="toggle-btn" data-controls="bg4">Background</button>
                        <button class="toggle-btn" data-controls="shadow4">Shadow</button>
                        <button class="toggle-btn" data-controls="fx4">FX</button>
                        <button class="toggle-btn" data-controls="presets4">Presets</button>
                    </div>
                    <div id="pos4" class="collapsible-controls">
                        <div class="text-position-controls">
                            <label>X: <input type="number" id="x4" class="pos-input" value="960"></label>
                            <label>Y: <input type="number" id="y4" class="pos-input" value="756"></label>
                            <button class="align-btn" data-align="left" data-line-index="3">L</button>
                            <button class="align-btn" data-align="center" data-line-index="3">C</button>
                            <button class="align-btn" data-align="right" data-line-index="3">R</button>
                        </div>
                    </div>
                    <div id="style4" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Stroke: <input type="color" id="strokeColor4" value="#000000"></label>
                            <label>Thick: <input type="number" id="strokeThickness4" class="pos-input" value="2" min="0" max="50"></label>
                        </div>
                    </div>
                    <div id="bg4" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>BG: <input type="color" id="bgColor4" value="#ffffff"></label> <!-- Default to white, alpha will be set by JS -->
                            <label><input type="checkbox" id="bgFullWidth4"> Full BG</label>
                            <label>BG Pad: <input type="number" id="bgPadding4" class="pos-input" value="10" min="0" max="50"></label>
                            <label>BG Alpha: <input type="range" id="bgAlpha4" min="0" max="100" value="0" step="5"> <span id="bgAlphaValue4">0%</span></label>
                        </div>
                    </div>
                    <div id="shadow4" class="collapsible-controls">
                        <div class="text-style-controls text-style-grid-row">
                            <label title="Enable Shadow"><input type="checkbox" id="shadowEnabled4"> Enable Shadow</label>
                            <label>Shadow Color: <input type="color" id="shadowColor4" value="#000000"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Shadow Alpha: <input type="range" id="shadowAlpha4" min="0" max="100" value="50" step="5"> <span id="shadowAlphaValue4">50%</span></label>
                            <label>Shadow Blur: <input type="number" id="shadowBlur4" class="pos-input" value="5" min="0" max="50"></label>
                        </div>
                        <div class="text-style-controls text-style-grid-row">
                            <label>Offset X: <input type="number" id="shadowOffsetX4" class="pos-input" value="2" min="-50" max="50"></label>
                            <label>Offset Y: <input type="number" id="shadowOffsetY4" class="pos-input" value="2" min="-50" max="50"></label>
                        </div>
                    </div>
                    <div id="fx4" class="collapsible-controls">
                        <div class="text-style-controls">
                            <label>Font:
                                <select id="fontFamily4">
                                    <!-- Options will be populated by script.js -->
                                </select>
                            </label>
                            <label>Effect:
                                <select id="advancedEffectType4">
                                    <option value="none">None</option>
                                    <option value="neon">Neon</option>
                                    <option value="splice">Splice</option>
                                    <option value="echo">Echo</option>
                                    <option value="glitch">Glitch</option>
                                </select>
                            </label>
                        </div>
                        <!-- Contextual controls for effects, hidden by default -->
                        <div id="fx-params4" class="text-style-controls fx-params">
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C1: <input type="color" id="effectColor1_4"></label>
                            <label class="fx-param-control" data-fx-for="neon splice echo glitch">FX C2: <input type="color" id="effectColor2_4"></label>
                            <label class="fx-param-control" data-fx-for="glitch">FX C3: <input type="color" id="effectColor3_4"></label>
                            <label class="fx-param-control" data-fx-for="splice echo glitch">Dist: <input type="range" id="effectDistance4" min="0" max="50" value="10"></label>
                            <label class="fx-param-control" data-fx-for="splice echo">Angle: <input type="range" id="effectAngle4" min="-180" max="180" value="-45"></label>
                            <label class="fx-param-control" data-fx-for="neon">Glow: <input type="range" id="effectGlowSize4" min="0" max="100" value="20"></label>
                        </div>
                    </div>
                    <div id="presets4" class="collapsible-controls preset-gallery">
                        <!-- Preset previews will be generated here by JS -->
                    </div>   
                </div> 
                <div class="presets" id="line4Presets">
                    <button class="preset-btn" data-preset-group="line4" data-preset-value="HITS, STRIKES, LOSSES, OTHER">Hits, Losses, Strikes, Other</button>
                    <button class="preset-btn" data-preset-group="line4" data-preset-value="MILITARY AID">Military Aid</button>
                    <button class="preset-btn" data-preset-group="line4" data-preset-value="GEOPOLITICAL NEWS">Geopolitical news</button>
                    <button class="preset-btn" data-preset-group="line4" data-preset-value="WITH JONATHAN FINK">With Jonathan Fink</button>
                    <button class="preset-btn" data-preset-group="line4" data-preset-value="3 DAY UPDATE">3 Day Update</button>
                </div>
            </div>

            <div class="panel-section" id="image-properties-panel" style="display: none;">
                <h2>Image Properties</h2>
                <div class="property-group">
                    <label>Size: <input type="range" id="image-size" min="50" max="1000" value="200"></label>
                </div>
                <div class="property-group">
                    <label>Stroke Color: <input type="color" id="image-stroke-color" value="#000000"></label>
                    <label>Stroke Width: <input type="range" id="image-stroke-width" min="0" max="50" value="2"></label>
                </div>
                <div class="property-group">
                    <label>Shadow Color: <input type="color" id="image-shadow-color" value="#000000"></label>
                    <label>Shadow Blur: <input type="range" id="image-shadow-blur" min="0" max="50" value="5"></label>
                    <label>Shadow Offset X: <input type="range" id="image-shadow-offset-x" min="-50" max="50" value="5"></label>
                    <label>Shadow Offset Y: <input type="range" id="image-shadow-offset-y" min="-50" max="50" value="5"></label>
                </div>
            </div>

            <div class="panel-section">
                <h2>Export</h2>
                <button id="export-layout-btn" class="upload-btn" style="width: 100%;">Copy Layout Code</button>
                <div id="copy-feedback"></div>
            </div>
        </aside>




        <main class="center-panel">
            <!-- The canvas and its direct controls go here -->
            <div class="canvas-controls">
                 <button id="upload-image-btn" class="upload-btn">Upload Image</button>
                 <button id="paste-image-btn" class="upload-btn">Paste Image</button>
                 <input type="file" id="imageInput" accept="image/*" style="display: none;">
                 <button id="show-ai-modal-btn" class="upload-btn" style="background-color: #9C27B0;">Generate AI Image</button>
            </div>
            <div class="canvas-container">
                <canvas id="thumbnailCanvas"></canvas>
            </div>
            <button id="download-thumbnail-btn" style="width: 100%; font-size: 20px; padding: 15px;">Download Thumbnail</button>
        </main>

        <aside class="right-panel">
            <!-- All the context-sensitive properties go here -->
            <div class="panel-section">
                <h2>Background Image</h2>


                <div class="opacity-control">
                    <label for="bg-brightness">Brightness:</label>
                    <input type="range" id="bg-brightness" min="0" max="200" value="100" step="5">
                    <span id="bg-brightness-value">100%</span>
                </div>
                <div class="opacity-control">
                    <label for="bg-contrast">Contrast:</label>
                    <input type="range" id="bg-contrast" min="0" max="200" value="100" step="5">
                    <span id="bg-contrast-value">100%</span>
                </div>
                <div class="opacity-control">
                    <label for="bg-saturate">Saturation:</label>
                    <input type="range" id="bg-saturate" min="0" max="200" value="100" step="5">
                    <span id="bg-saturate-value">100%</span>
                </div>

                <!-- New Filters -->
                <div class="opacity-control">
                    <label for="bg-warmth">Warmth:</label>
                    <input type="range" id="bg-warmth" min="0" max="200" value="100" step="5">
                    <span id="bg-warmth-value">100%</span>
                </div>
                <div class="opacity-control">
                    <label for="bg-exposure">Exposure:</label>
                    <input type="range" id="bg-exposure" min="0" max="200" value="100" step="5">
                    <span id="bg-exposure-value">100%</span>
                </div>
                <div class="opacity-control">
                    <label for="bg-tint-color">Tint Color:</label>
                    <input type="color" id="bg-tint-color" value="#FFBF00"> <!-- Default orange/yellow tint -->
                </div>
                <div class="opacity-control">
                    <label for="bg-tint-strength">Tint Strength:</label>
                    <input type="range" id="bg-tint-strength" min="0" max="100" value="0" step="5">
                    <span id="bg-tint-strength-value">0%</span>
                </div>
                <div class="opacity-control">
                    <label for="bg-vignette">Vignette:</label>
                    <input type="range" id="bg-vignette" min="0" max="100" value="0" step="5">
                    <span id="bg-vignette-value">0%</span>
                </div>
                <!-- End New Filters -->

                <div class="opacity-control">
                    <label for="imageOpacity">Image Opacity:</label>
                    <input type="range" id="imageOpacity" min="0" max="100" value="100" step="5">
                    <span id="opacityValue">100%</span>
                </div>
                
                <!-- NEW: Zoom Control -->
                <div class="opacity-control">
                    <label for="imageZoom">Image Zoom:</label>
                    <input type="range" id="imageZoomSlider" min="100" max="300" value="100" step="10">
                    <span id="zoomValue">100%</span>
                </div>
            </div>
            <div class="panel-section">            
                <h2 class="section-header">Alignment Guides</h2>
                <div class="text-style-controls">
                    <label><input type="checkbox" id="overlay-thirds" onchange="drawThumbnail()"> Rule of Thirds</label>
                    <label><input type="checkbox" id="overlay-center" onchange="drawThumbnail()"> Center Lines</label>
                </div>
            </div>
            <div class="panel-section">
                <h2>Logo Overlay</h2>
                <div class="logo-controls-container">
                    <div class="logo-selection">
                        <!-- Use img tags for thumbnails. The 'data-src' holds the actual image file name. -->
                        <img src="logo-none.png" alt="No Logo" class="logo-thumb active" onclick="selectLogo(this, null)">
                        <img src="logo1.png" alt="Logo 1" class="logo-thumb" onclick="selectLogo(this, 'logo1.png')">
                        <img src="logo2.png" alt="Logo 2" class="logo-thumb" onclick="selectLogo(this, 'logo2.png')">
                        <img src="logo3.png" alt="Logo 3" class="logo-thumb" onclick="selectLogo(this, 'logo3.png')">
                        <img src="logo4.png" alt="Logo 4" class="logo-thumb" onclick="selectLogo(this, 'logo4.png')">
                        <img src="logo5.png" alt="Logo 5" class="logo-thumb" onclick="selectLogo(this, 'logo5.png')">
                        <img src="logo6.png" alt="Logo 6" class="logo-thumb" onclick="selectLogo(this, 'logo6.png')">
                        <img src="logo7.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'logo7.png')">
                        <img src="atp-red.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-red.png')">
                        <img src="atp-black.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-black.png')">
                        <img src="atp-white.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-white.png')">
                        <img src="atp-gradient1.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-gradient1.png')">
                        <img src="atp-gradient2.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-gradient2.png')">
                        <img src="atp-gradient3.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-gradient3.png')">
                        <img src="atp-gradient-round.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-gradient-round.png')">
                        <img src="atp-black-round.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-black-round.png')">
                        <img src="atp-cream-round.png" alt="Logo 7" class="logo-thumb" onclick="selectLogo(this, 'atp-cream-round.png')">
                    </div>
                    <div class="logo-position-controls">
                        <label>Position:</label>
                        <button class="logo-pos-btn" onclick="setLogoPosition('top-left')">TL</button>
                        <button class="logo-pos-btn" onclick="setLogoPosition('top-right')">TR</button>
                        <button class="logo-pos-btn active" onclick="setLogoPosition('bottom-left')">BL</button> <!-- MODIFIED: Changed default to BL -->
                        <button class="logo-pos-btn" onclick="setLogoPosition('bottom-right')">BR</button>
                    </div>    
                    <div class="logo-size-controls">
                        <label for="logoScale">Size:</label>
                        <input type="range" id="logoScale" min="5" max="50" value="15" step="1">
                        <span id="logoScaleValue">15%</span>
                    </div>
                </div>
            </div>
            <div class="panel-section" id="object-properties-panel" style="display: none;">
                <h2 class="section-header">Selected Object Properties</h2>
                    
                
            
                <div id="properties-content">
                 
                </div>
            
                <button onclick="deleteSelectedObject()" style="background-color: #f44336; margin-top: 15px;" id="delete-object-btn">Delete Selected Object</button>
            </div>
        </aside>
    </div>

    <!-- AI Image Generation Modal -->
    <div id="ai-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>AI Image Generation</h2>
            <div class="ai-controls">
                <!-- Row for Prompt Textarea and Generate Button -->
                <div class="ai-prompt-row">
                    <textarea id="ai-prompt" placeholder="Describe the image you want to create..."></textarea>
                    <button id="ai-generate-btn" class="ai-action-btn">Generate</button>
                </div>

                <!-- Row for Preset Prompts and AI Model Selection -->
                <div class="ai-row">
                    <label>Preset:</label>
                    <select id="ai-preset-prompts">
                        <option value="">-- Custom Prompt --</option>
                        <option value="The motherland monument in Kyiv, Ukraine, stylistic artist impression, cinematic, wide shot, 8k, hyperrealistic">Motherland Monument</option>
                        <option value="A dramatic explosion in a modern city street, cinematic, fire and smoke, high action, 8k photo">City Explosion</option>
                        <option value="Abstract background, blue and yellow energy waves, digital art, futuristic, clean">Abstract Energy</option>
                    </select>
                    <label>Model:</label>
                    <select id="ai-model">
                        <option value="black-forest-labs/flux-schnell">Flux Schnell</option>
                        <option value="minimax/image-01">Minimax Image-01</option>
                        <option value="luma/photon-flash">Luma Photon Flash</option>
                        <option value="google/imagen-4-fast">Google Imagen 4 Fast</option>
                        <option value="luma/photon">Luma Photon</option>
                        <option value="bytedance/seedream-3">ByteDance SeeD-ream 3</option>
                        <option value="google/imagen-4">Google Imagen 4</option>
                        <option value="recraft-ai/recraft-v3">Recraft V3</option>
                        <option value="google/imagen-4-ultra">Google Imagen 4 Ultra</option>
                        <option value="ideogram-ai/ideogram-v3-balanced">Ideogram V3 Balanced</option>
                        <option value="stability-ai/stable-diffusion-3.5-large">Stable Diffusion 3.5 Large</option>
                        <option value="ideogram-ai/ideogram-v3-turbo">Ideogram V3 Turbo</option>
                        <optgroup label="Edit Models (require input image)">
                            <option value="bytedance/seededit-3.0">ByteDance SeedEdit 3.0</option>
                            <option value="black-forest-labs/flux-kontext-max">Flux Kontext Max</option>
                            <option value="black-forest-labs/flux-kontext-pro">Flux Kontext Pro</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Hidden File Input for Image Upload -->
                <input type="file" id="ai-input-image-upload" accept="image/*" style="display: none;">


            </div>

            <div class="ai-previews-container">
                <!-- Input Image Preview Box -->
                <div class="ai-preview-box" id="ai-input-preview-box">
                    <h4>Input Image</h4>
                    <img id="ai-input-image-preview" src="#" alt="Input Preview" style="display:none;"/>
                    <div class="placeholder-text">Upload an image (optional for most models, required for edit models).</div>
                    <button class="ai-action-btn" id="ai-upload-btn-under-preview" onclick="document.getElementById('ai-input-image-upload').click();">Upload Image</button>
                </div>

                <button id="ai-copy-output-to-input" class="ai-transfer-btn" onclick="copyAiOutputToInput()" title="Copy Output to Input"></button>

                <!-- Output Image Preview Box -->
                <div class="ai-preview-box" id="ai-output-preview-box">
                    <h4>Output Image</h4>
                    <div id="ai-loader" class="loader" style="display: none;"></div>
                    <img id="ai-preview-img" src="" alt="AI Generated Image Preview"/>
                    <div class="placeholder-text">Generated image will appear here.</div>
                    <button class="ai-action-btn" id="ai-download-btn" disabled>Download Output</button>
                    <button class="ai-action-btn" id="ai-set-bg-btn" disabled>Download & Set Background</button>
                </div>
            </div>

            <!-- Old .ai-actions div is removed as its buttons are relocated -->

            <button id="ai-close-btn" style="margin-top: 20px; background-color: #f44336;">Close</button>
        </div>
    </div>
    <div id="snippet-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div id="snippet-step1">
                <h2>Step 1: Choose a Style</h2>
                <div id="snippet-preset-gallery" class="preset-gallery">
                <!-- Snippet preset previews will be generated here -->
                </div>
            </div>
            <div id="snippet-step2" style="display: none;">
                <h2>Step 2: Choose a Word</h2>
                <div id="snippet-word-choices" class="presets">
                <!-- Word choice buttons will be generated here -->
                </div>
            </div>
            <button id="snippet-cancel-btn" style="margin-top: 20px; background-color: #f44336;">Cancel</button>
        </div>
    </div>

    <!-- Font Preview Modal -->
    <div id="fontPreviewModal" class="modal-overlay"> <!-- ID changed to camelCase, inline style removed -->
        <div class="font-preview-modal-content"> <!-- Class changed to be more specific -->
            <span id="font-preview-close-btn" class="close-modal-btn">&times;</span>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">Font Previews</h2>
            </div>
            <div id="font-preview-gallery" class="font-preview-grid"> <!-- Class changed to match CSS grid styles -->
                <!-- Font previews will be generated here by JS -->
            </div>
            <!-- The close button was moved to the header -->
        </div>
    </div>

    <!-- Emoji Picker Popup -->
    <div id="emoji-picker-popup" style="display: none; position: absolute; z-index: 1001; border: 1px solid #ccc; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
        <emoji-picker class="light" locale="en" data-source="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json"></emoji-picker>
    </div>

    <!-- Image Enlarge Modal -->
    <div id="enlarge-image-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content image-modal-content">
            <span id="enlarge-image-close-btn" class="close-modal-btn">&times;</span>
            <img id="enlarged-image-element" src="" alt="Enlarged Image"/>
        </div>
    </div>
    <div id="person-picker-modal" class="modal">
        <div class="modal-content">
            <span id="person-picker-close-btn" class="close-button">&times;</span>
            <div id="person-picker-step1">
                <h2>Select a Person</h2>
                <div id="person-selection-grid" class="selection-grid"></div>
            </div>
            <div id="person-picker-step2" style="display:none;">
                <h2>Select Emotion/Pose for <span id="selected-person-name"></span></h2>
                <div id="emotion-selection-grid" class="selection-grid"></div>
                <div class="flip-option">
                    <input type="checkbox" id="flip-person-image">
                    <label for="flip-person-image">Flip Image Vertically</label>
                </div>
                <button id="person-picker-back-btn">Back to People</button>
            </div>
        </div>
    </div>

    <!-- Shape Picker Modal -->
    <div id="shape-picker-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span id="shape-picker-close-btn" class="close-button">&times;</span>
            <div id="shape-picker-step1">
                <h2>Step 1: Choose a Shape</h2>
                <div id="shape-type-grid" class="selection-grid">
                    <button class="shape-type-btn" data-shape-type="arrow">
                        <div class="shape-preview"></div>
                        <span>Arrow</span>
                    </button>
                    <button class="shape-type-btn" data-shape-type="circle">
                        <div class="shape-preview"></div>
                        <span>Circle</span>
                    </button>
                    <button class="shape-type-btn" data-shape-type="square">
                        <div class="shape-preview"></div>
                        <span>Square</span>
                    </button>
                    <button class="shape-type-btn" data-shape-type="target">
                        <div class="shape-preview"></div>
                        <span>Target</span>
                    </button>
                    <button class="shape-type-btn" data-shape-type="line">
                        <div class="shape-preview"></div>
                        <span>Line</span>
                    </button>
                </div>
            </div>
            <div id="shape-picker-step2" style="display: none;">
                <h2>Step 2: Choose a Style for <span id="selected-shape-name"></span></h2>
                <div id="shape-style-grid" class="selection-grid">
                    <!-- Shape style options will be populated here -->
                </div>
                <button id="shape-picker-back-btn">Back to Shapes</button>
            </div>
        </div>
    </div>
</body>

</html>
